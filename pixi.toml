[workspace]
authors = ["James Brodovsky <james.brodovsky@gmail.com>"]
channels = ["conda-forge"]
name = "strapdown-rs"
platforms = ["linux-64", "osx-64", "win-64"]
version = "0.0.1"
description = "A simple strapdown INS implementation in Rust with accompanying simulation and geo-location capabilities."
license = "MIT"

[activation.env]
RUST_BACKTRACE = "1"
HDF5_DIR = "${PIXI_PROJECT_ROOT}/.pixi/envs/default"
RUSTFLAGS="-C link-args=-Wl,-rpath,.pixi/envs/default/include/lib"
PATH = "${PIXI_PROJECT_ROOT}/target/release:${PATH}"
RUSTDOCFLAGS="--html-in-header ${PIXI_PROJECT_ROOT}/katex-header.html"

[tasks]
build = "cargo build --workspace --release"
lint = "ruff check --select I --fix && cargo clippy --all-targets --all-features --fix --allow-dirty -- -D warnings"
fmt = "ruff format . && cargo fmt"
preprocess = "python scripts/preprocess.py --input_dir data/raw/ --output_dir data/input/"
code = "code ."
coverage = "cargo tarpaulin --workspace --timeout 600"
# analysis = "analysis"
#test = "pytest --cov=geophysical_nav --cov-report=xml --cov-report=html"

[tasks.getmaps]
args = [
    {"arg" = "input", "default" = "data/input/"},
    {"arg" = "buffer", "default" = "0.75"},
    {"arg" = "output", "default" = "data/input/"}
]
cmd = "python scripts/get_maps.py --input {{ input }} --buffer {{ buffer }} --output {{ output }}"

[tasks.create_dataset]
args = [
    {"arg" = "bin", "default" = "target/release/strapdown-sim"},
    {"arg" = "input", "default" = "data/input/"},
    {"arg" = "output_root", "default" = "data/"}
]
cmd = "python scripts/create_dataset.py --bin {{ bin }} --input {{ input }} --output-root {{ output_root }}"

[tasks.truth]
args = [
    {"arg" = "input", "default" = "data/input/"},
    {"arg" = "output", "default" = "data/baseline/"}
]
cmd = "python scripts/truth.py --input-dir {{ input }} --output-dir {{ output }}"

[dependencies]
python = ">=3.12,<3.14"
rust = ">=1.91.0,<1.92"
rust-src = ">=1.91.0,<2"
uv = ">=0.9.21,<0.10"
gmt = ">=6.6.0,<7"
pkg-config = ">=0.29.2,<0.30"
libfreetype6 = ">=2.14.1,<3"
fontconfig = ">=2.15.0,<3"

[pypi-dependencies]
anglewrapper = ">=0.1.1, <0.2"
analysis = {path = "./analysis", editable = true}

