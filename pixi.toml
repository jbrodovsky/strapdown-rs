[workspace]
authors = ["James Brodovsky <james.brodovsky@gmail.com>"]
channels = ["conda-forge"]
name = "strapdown-rs"
platforms = ["linux-64", "osx-64", "win-64"]
version = "0.0.1"
description = "A simple strapdown INS implementation in Rust with accompanying simulation and geo-location capabilities."
license = "MIT"

[activation.env]
RUST_BACKTRACE = "1"
HDF5_DIR = "${PIXI_PROJECT_ROOT}/.pixi/envs/default"
RUSTFLAGS="-C link-args=-Wl,-rpath,.pixi/envs/default/include/lib"
PATH = "${PIXI_PROJECT_ROOT}/target/release:${PATH}"
RUSTDOCFLAGS="--html-in-header ${PIXI_PROJECT_ROOT}/katex-header.html"
PKG_CONFIG_PATH = "${PIXI_PROJECT_ROOT}/.pixi/envs/default/lib/pkgconfig"

[tasks]
build = "cargo build --workspace --release"
lint = "ruff check --select I --fix && cargo clippy --all-targets --all-features --fix --allow-dirty -- -D warnings"
fmt = "ruff format . && cargo fmt"
code = "code ."
coverage = "cargo tarpaulin --workspace --timeout 600"
sim = """
./target/release/strapdown-sim --config conf/ukf_truth.toml && \
./target/release/strapdown-sim --config conf/ukf_both.toml && \
./target/release/strapdown-sim --config conf/ukf_grav.toml && \
./target/release/strapdown-sim --config conf/ukf_mag.toml && \
./target/release/strapdown-sim --config conf/ekf_truth.toml && \
./target/release/strapdown-sim --config conf/ekf_both.toml && \
./target/release/strapdown-sim --config conf/ekf_grav.toml && \
./target/release/strapdown-sim --config conf/ekf_mag.toml
"""

postprocess = """
analyze performance --processed data/output/ukf/truth --reference data/input/ --output data/output/ukf/truth/performance && \
analyze performance --processed data/output/ukf/both --reference data/input/ --output data/output/ukf/both/performance && \
analyze performance --processed data/output/ukf/grav --reference data/input/ --output data/output/ukf/grav/performance && \
analyze performance --processed data/output/ukf/mag --reference data/input/ --output data/output/ukf/mag/performance && \
analyze performance --processed data/output/ekf/truth --reference data/input/ --output data/output/ekf/truth/performance && \
analyze performance --processed data/output/ekf/both --reference data/input/ --output data/output/ekf/both/performance && \
analyze performance --processed data/output/ekf/grav --reference data/input/ --output data/output/ekf/grav/performance && \
analyze performance --processed data/output/ekf/mag --reference data/input/ --output data/output/ekf/mag/performance
"""

# Particle filter simulation with post-processing
pf-gravity = """
pf-sim --ins-dir data/output/ukf/degraded --imu-dir data/input --output-dir data/output/pf/gravity_ukf --geo-type gravity --gravity-noise-std 48.93 --num-particles 5000 && \
pf-sim --ins-dir data/output/ekf/degraded --imu-dir data/input --output-dir data/output/pf/gravity_ekf --geo-type gravity --gravity-noise-std 48.93 --num-particles 5000
"""

pf-magnetic = """
pf-sim --ins-dir data/output/ukf/degraded --imu-dir data/input --output-dir data/output/pf/magnetic_ukf --geo-type magnetic --magnetic-noise-std 42303 --num-particles 5000 && \
pf-sim --ins-dir data/output/ekf/degraded --imu-dir data/input --output-dir data/output/pf/magnetic_ekf --geo-type magnetic --magnetic-noise-std 42303 --num-particles 5000
"""

pf-combined = """
pf-sim --ins-dir data/output/ukf/degraded --imu-dir data/input --output-dir data/output/pf/combined_ukf --geo-type combined --gravity-noise-std 48.93 --magnetic-noise-std 42303 --num-particles 5000 && \
pf-sim --ins-dir data/output/ekf/degraded --imu-dir data/input --output-dir data/output/pf/combined_ekf --geo-type combined --gravity-noise-std 48.93 --magnetic-noise-std 42303 --num-particles 5000
"""

# Standalone post-processing for existing PF results
pf-postprocess = """
pf-postprocess -i data/output/pf/gravity && \
pf-postprocess -i data/output/pf/magnetic && \
pf-postprocess -i data/output/pf/combined
"""

[dependencies]
python = ">=3.12,<3.14"
rust = ">=1.91.0,<1.92"
rust-src = ">=1.91.0,<2"
uv = ">=0.9.21,<0.10"
gmt = ">=6.6.0,<7"
pkg-config = ">=0.29.2,<0.30"
libfreetype6 = ">=2.14.1,<3"
fontconfig = ">=2.15.0,<3"
expat = ">=2.6.4,<3"
ruff = ">=0.14.11,<0.15"

[pypi-dependencies]
analysis = {path = "./analysis", editable = true}
pf = {path = "./pf", editable = true}
